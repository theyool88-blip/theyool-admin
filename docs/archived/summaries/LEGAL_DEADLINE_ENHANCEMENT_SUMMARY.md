# ë²•ì • ê¸°ê°„ ê³„ì‚° ì‹œìŠ¤í…œ ê³ ë„í™” ì™„ë£Œ ë³´ê³ ì„œ

**ë‚ ì§œ**: 2025-11-22
**ì‘ì—…ì**: Claude Code
**ëª©ì **: ë¯¼ë²• ì œ161ì¡° ë° ë¯¼ì‚¬ì†Œì†¡ë²• ë¶ˆë³€ê¸°ê°„ ì™„ì „ ì¤€ìˆ˜

---

## ğŸ“Š ì‘ì—… ìš”ì•½

### ì™„ë£Œëœ ì‘ì—… (6ê°œ)

1. âœ… **í•œêµ­ ê³µíœ´ì¼ ìº˜ë¦°ë” ë°ì´í„° ë° ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ìƒì„±**
2. âœ… **ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ë¦¬ê±° ì—…ë°ì´íŠ¸ (ì£¼ë§/ê³µíœ´ì¼ ì—°ì¥ ì²˜ë¦¬)**
3. âœ… **ì—ì§€ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸ (ì£¼ë§, ê³µíœ´ì¼)**
4. âœ… **ì¶”ê°€ ë¶ˆë³€ê¸°ê°„ ìœ í˜• ê²€í†  ë° ì¶”ê°€**
5. âœ… **deadline_types í…Œì´ë¸” ì—…ë°ì´íŠ¸**
6. âœ… **ì‹œìŠ¤í…œ ë¬¸ì„œí™” ë° ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ ì‘ì„±**

---

## ğŸ¯ ì£¼ìš” ê°œì„  ì‚¬í•­

### 1. ë¯¼ë²• ì œ161ì¡° ì™„ì „ ì ìš©

**ì´ì „ (v1.0)**:
```sql
-- ë‹¨ìˆœ ì¼ìˆ˜ ë”í•˜ê¸°ë§Œ ìˆ˜í–‰
v_deadline_date := NEW.trigger_date + (v_days || ' days')::INTERVAL;
```

**í˜„ì¬ (v2.0)**:
```sql
-- ë¯¼ë²• ì œ161ì¡° ìë™ ì ìš©
v_deadline_date := calculate_legal_deadline(
  NEW.trigger_date,
  v_days,
  v_exclude_initial_day
);
-- â†’ í† ìš”ì¼/ê³µíœ´ì¼ì´ë©´ ë‹¤ìŒ ì˜ì—…ì¼ë¡œ ìë™ ì—°ì¥
```

### 2. ëŒ€í•œë¯¼êµ­ ê³µíœ´ì¼ ë°ì´í„°ë² ì´ìŠ¤

- **2025ë…„ ë²•ì • ê³µíœ´ì¼ 17ê°œ ë“±ë¡**
- ì¼ìš”ì¼ ìë™ ê³µíœ´ì¼ ì²˜ë¦¬
- ê³µíœ´ì¼ í…Œì´ë¸” (`korean_public_holidays`) ìƒì„±

### 3. ë¶ˆë³€ê¸°ê°„ ìœ í˜• í™•ëŒ€

**ì´ì „**: 5ê°œ
- ìƒì†Œê¸°ê°„
- ì¡°ì •Â·í™”í•´ ì´ì˜ê¸°ê°„
- ì¦‰ì‹œí•­ê³ ê¸°ê°„
- í•­ì†Œì´ìœ ì„œ ì œì¶œê¸°í•œ
- ì¬ì‹¬ì˜ ì†Œ ì œê¸°ê¸°í•œ

**í˜„ì¬**: 13ê°œ (8ê°œ ì¶”ê°€)
- ìƒê³ ì´ìœ ì„œ ì œì¶œê¸°í•œ (20ì¼)
- ì§€ê¸‰ëª…ë ¹ ì´ì˜ì‹ ì²­ (14ì¼)
- í™”í•´ê¶Œê³ ê²°ì • ì´ì˜ì‹ ì²­ (14ì¼)
- í•­ì†Œê°í•˜ê²°ì • ì¦‰ì‹œí•­ê³  (7ì¼)
- ê°€ì‚¬ì†Œì†¡ í•­ì†Œê¸°ê°„ (14ì¼)
- ê°€ì‚¬ì†Œì†¡ ì¬ì‹¬ (30ì¼)
- ì§‘í–‰ì´ì˜ (14ì¼)
- ê°€ì²˜ë¶„ ì´ì˜ (14ì¼)

### 4. ì—°ì¥ ê°€ëŠ¥ ê¸°ê°„ ê´€ë¦¬

- í•­ì†Œì´ìœ ì„œ ì œì¶œê¸°í•œ: **1ê°œì›” ì—°ì¥ ê°€ëŠ¥ (ìµœëŒ€ 1íšŒ)**
- ì—°ì¥ ì´ë ¥ í…Œì´ë¸” (`deadline_extensions`) ìƒì„±

---

## ğŸ“ ìƒì„±ëœ íŒŒì¼

### 1. TypeScript ìœ í‹¸ë¦¬í‹°

**`lib/utils/korean-legal-dates.ts`** (ìƒˆ íŒŒì¼)
```typescript
// ì£¼ìš” í•¨ìˆ˜:
- isSaturday(date): boolean
- isSunday(date): boolean
- isPublicHoliday(date): boolean
- isNonBusinessDay(date): boolean
- getNextBusinessDay(date): Date
- calculateLegalDeadline(triggerDate, days, excludeInitialDay): Date
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

**`supabase/migrations/20251122_enhanced_deadline_calculation.sql`** (ìƒˆ íŒŒì¼)
- ê³µíœ´ì¼ í…Œì´ë¸” ìƒì„±
- 2025ë…„ ê³µíœ´ì¼ ë°ì´í„° ì‚½ì…
- ë²•ì • ê¸°ê°„ ê³„ì‚° í•¨ìˆ˜ ìƒì„± (PostgreSQL)
- ê¸°ì¡´ ë°ë“œë¼ì¸ ë°ì´í„° ìë™ ì¬ê³„ì‚°

**`supabase/migrations/20251122_add_all_immutable_periods.sql`** (ìƒˆ íŒŒì¼)
- 13ê°€ì§€ ë¶ˆë³€ê¸°ê°„ ìœ í˜• ì¶”ê°€
- ì—°ì¥ ê°€ëŠ¥ ê¸°ê°„ ì„¤ì •
- ì—°ì¥ ì´ë ¥ í…Œì´ë¸” ìƒì„±

### 3. í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸

**`scripts/test-legal-deadline-calculation.ts`** (ìƒˆ íŒŒì¼)
- 7ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤
- ì„±ê³µë¥ : **100%**
- í† ìš”ì¼/ì¼ìš”ì¼/ê³µíœ´ì¼/ì¶”ì„ ì—°íœ´ ë“± ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦

### 4. ë¬¸ì„œí™”

**`LEGAL_DEADLINE_SYSTEM.md`** (ìƒˆ íŒŒì¼)
- ì‹œìŠ¤í…œ ê°œìš”
- ë²•ì  ê·¼ê±°
- ì‹œìŠ¤í…œ êµ¬ì¡°
- 13ê°€ì§€ ë¶ˆë³€ê¸°ê°„ ì¢…ë¥˜
- ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ
- ì‚¬ìš© ë°©ë²•
- íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### ìë™ í…ŒìŠ¤íŠ¸ (100% í†µê³¼)

```
ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½:
  ì´ í…ŒìŠ¤íŠ¸: 7ê°œ
  âœ… í†µê³¼: 7ê°œ
  âŒ ì‹¤íŒ¨: 0ê°œ
  ì„±ê³µë¥ : 100.0%
```

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤**:
1. âœ… í‰ì¼ ì„ ê³  â†’ í‰ì¼ ë§Œë£Œ
2. âœ… í‰ì¼ ì„ ê³  â†’ í† ìš”ì¼ ë§Œë£Œ â†’ ì›”ìš”ì¼ ì—°ì¥
3. âœ… í‰ì¼ ì„ ê³  â†’ ì¼ìš”ì¼ ë§Œë£Œ â†’ ì›”ìš”ì¼ ì—°ì¥
4. âœ… í‰ì¼ ì„ ê³  â†’ ì–´ë¦°ì´ë‚  ë§Œë£Œ â†’ ëŒ€ì²´ê³µíœ´ì¼ ë‹¤ìŒë‚ ë¡œ ì—°ì¥
5. âœ… í‰ì¼ ì„ ê³  â†’ ì¶”ì„ ì—°íœ´ ë§Œë£Œ â†’ ì—°íœ´ ë‹¤ìŒë‚ ë¡œ ì—°ì¥
6. âœ… ì´ˆì¼ë¶ˆì‚°ì… ì ìš© (ì¦‰ì‹œí•­ê³ ê¸°ê°„)
7. âœ… ì—°ë§ ì„ ê³  â†’ ì‹ ì • ë§Œë£Œ â†’ ì—°ì¥

### ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ì¶”ì„ ì—°íœ´ ì²˜ë¦¬
- ê¸°ì‚°ì¼: 2025-09-22 (ì›”ìš”ì¼)
- ê¸°ê°„: 14ì¼
- ê³„ì‚° ê²°ê³¼: **2025-10-10 (ê¸ˆìš”ì¼)**
- ê²€ì¦: âœ… ì •í™•
  - 10/6 (ì¶”ì„) â†’ 10/7 (ì¶”ì„ì—°íœ´) â†’ 10/8 (ëŒ€ì²´ê³µíœ´ì¼) â†’ 10/9 (í•œê¸€ë‚ ) â†’ 10/10 (ê¸ˆ)

#### ì‹œë‚˜ë¦¬ì˜¤ 2: í† ìš”ì¼ ì—°ì¥
- ê¸°ì‚°ì¼: 2025-03-01 (í† ìš”ì¼, ì‚¼ì¼ì ˆ)
- ê¸°ê°„: 14ì¼
- ê³„ì‚° ê²°ê³¼: **2025-03-17 (ì›”ìš”ì¼)**
- ê²€ì¦: âœ… ì •í™•
  - 3/15 (í† ìš”ì¼) â†’ ë¯¼ë²• ì œ161ì¡°ì— ë”°ë¼ 3/17 (ì›”ìš”ì¼)ë¡œ ì—°ì¥

---

## ğŸ” ë²•ì  ê·¼ê±° í™•ì¸ (ì›¹ ê²€ìƒ‰ ê²°ê³¼)

### ë¯¼ë²• ì œ161ì¡°
> ê¸°ê°„ì˜ ë§ì¼ì´ í† ìš”ì¼ ë˜ëŠ” ê³µíœ´ì¼ì— í•´ë‹¹í•œ ë•Œì—ëŠ” ê¸°ê°„ì€ ê·¸ ìµì¼ë¡œ ë§Œë£Œí•œë‹¤.

### ë¯¼ì‚¬ì†Œì†¡ë²• (2025. 3. 1. ì‹œí–‰)
- **í•­ì†Œì´ìœ ì„œ ì œì¶œê¸°í•œ**: 40ì¼ (1ê°œì›” ì—°ì¥ ê°€ëŠ¥, ìµœëŒ€ 1íšŒ)
- **ìƒê³ ì´ìœ ì„œ ì œì¶œê¸°í•œ**: 20ì¼ (ì—°ì¥ ë¶ˆê°€)
- **ì§€ê¸‰ëª…ë ¹ ì´ì˜ì‹ ì²­**: 2ì£¼ì¼
- **í™”í•´ê¶Œê³ ê²°ì • ì´ì˜ì‹ ì²­**: 2ì£¼ì¼

**ì°¸ê³  ìë£Œ**:
- [ë¯¼ì‚¬ì†Œì†¡ë²• ê°œì • (2025. 3. 1. ì‹œí–‰)](https://www.classhklaw.com/newsletter_view.php?seq=2815)
- [ë‚˜í™€ë¡œ ë¯¼ì‚¬ì†Œì†¡ ê°€ì´ë“œ](https://easylaw.go.kr/CSP/CnpClsMain.laf?popMenu=ov&csmSeq=568&ccfNo=7&cciNo=2&cnpClsNo=1)
- [ë¶ˆë³€ê¸°ê°„ ê³„ì‚°ê¸°](http://support.lawtop.co.kr/immutable/index.asp)

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„ (ë§ˆì´ê·¸ë ˆì´ì…˜)

### Step 1: í–¥ìƒëœ ê³„ì‚° ì‹œìŠ¤í…œ ì„¤ì¹˜

```sql
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰:
-- supabase/migrations/20251122_enhanced_deadline_calculation.sql
```

**íš¨ê³¼**:
- ê³µíœ´ì¼ í…Œì´ë¸” ìƒì„± ë° 2025ë…„ ë°ì´í„° ì‚½ì…
- ë²•ì • ê¸°ê°„ ê³„ì‚° í•¨ìˆ˜ ìƒì„±
- ê¸°ì¡´ ë°ë“œë¼ì¸ ìë™ ì¬ê³„ì‚°

### Step 2: ì „ì²´ ë¶ˆë³€ê¸°ê°„ ìœ í˜• ì¶”ê°€

```sql
-- Supabase SQL Editorì—ì„œ ì‹¤í–‰:
-- supabase/migrations/20251122_add_all_immutable_periods.sql
```

**íš¨ê³¼**:
- 13ê°€ì§€ ë¶ˆë³€ê¸°ê°„ ìœ í˜• ì¶”ê°€
- í•­ì†Œì´ìœ ì„œ ì—°ì¥ ì„¤ì •
- ì—°ì¥ ì´ë ¥ í…Œì´ë¸” ìƒì„±

### Step 3: í…ŒìŠ¤íŠ¸

```bash
cd /Users/hskim/luseed
npx tsx scripts/test-legal-deadline-calculation.ts
```

**ê¸°ëŒ€ ê²°ê³¼**: 100% í†µê³¼

---

## ğŸ“ˆ ê°œì„  íš¨ê³¼

### 1. ë²•ì  ì •í™•ì„±
- âœ… ë¯¼ë²• ì œ161ì¡° ì™„ì „ ì¤€ìˆ˜
- âœ… ë¯¼ì‚¬ì†Œì†¡ë²• ë¶ˆë³€ê¸°ê°„ ì™„ì „ ì§€ì›
- âœ… ê³µíœ´ì¼ ìë™ ì²˜ë¦¬
- âœ… ì£¼ë§ ìë™ ì—°ì¥

### 2. ì—…ë¬´ íš¨ìœ¨ì„±
- âœ… ìˆ˜ë™ ê³„ì‚° ë¶ˆí•„ìš”
- âœ… íœ´ë¨¼ ì—ëŸ¬ ë°©ì§€
- âœ… ìë™ ë°ë“œë¼ì¸ ìƒì„±
- âœ… ì—°ì¥ ì´ë ¥ ê´€ë¦¬

### 3. ì‹œìŠ¤í…œ í™•ì¥ì„±
- âœ… 13ê°€ì§€ ë¶ˆë³€ê¸°ê°„ ì§€ì›
- âœ… ê³µíœ´ì¼ ë°ì´í„° ì—…ë°ì´íŠ¸ ìš©ì´
- âœ… ì—°ì¥ ê°€ëŠ¥ ê¸°ê°„ ìœ ì—° ê´€ë¦¬
- âœ… TypeScript íƒ€ì… ì•ˆì •ì„±

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì™„ë£Œëœ ì‘ì—…
- [x] ì›¹ ê²€ìƒ‰ìœ¼ë¡œ ë²•ì  ê·¼ê±° í™•ì¸
- [x] ë¯¼ë²• ì œ161ì¡° ì‚°ìˆ ì‹ ê²€ì¦
- [x] ê³µíœ´ì¼ ì˜ˆì™¸ ì²˜ë¦¬ êµ¬í˜„
- [x] ë‹¤ë¥¸ ë¶ˆë³€ê¸°ê°„ ìœ í˜• ê²€í†  ë° ì¶”ê°€
- [x] TypeScript ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‘ì„±
- [x] PostgreSQL í•¨ìˆ˜ ì‘ì„±
- [x] ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
- [x] í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
- [x] 100% í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
- [x] ë¬¸ì„œí™” ì™„ë£Œ

### ë‹¤ìŒ ì‘ì—… (ì‚¬ìš©ì ê²°ì •)
- [ ] Supabaseì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] ì‹¤ì œ ë°ì´í„°ë¡œ ê²€ì¦
- [ ] 2026ë…„ ê³µíœ´ì¼ ë°ì´í„° ì¶”ê°€

---

## ğŸ“ ê¸°ìˆ ì  í•˜ì´ë¼ì´íŠ¸

### 1. ì¬ê·€ì  ì˜ì—…ì¼ íƒìƒ‰
```sql
CREATE OR REPLACE FUNCTION get_next_business_day(from_date DATE)
RETURNS DATE AS $$
DECLARE
  v_next_day DATE;
  v_counter INTEGER := 0;
BEGIN
  v_next_day := from_date;

  LOOP
    IF NOT is_non_business_day(v_next_day) THEN
      RETURN v_next_day;
    END IF;

    v_next_day := v_next_day + INTERVAL '1 day';
    v_counter := v_counter + 1;

    -- ë¬´í•œë£¨í”„ ë°©ì§€ (ìµœëŒ€ 10ì¼)
    IF v_counter > 10 THEN
      EXIT;
    END IF;
  END LOOP;
END;
$$ LANGUAGE plpgsql;
```

### 2. ì¼ìš”ì¼ ê³µíœ´ì¼ ìë™ ì²˜ë¦¬
```typescript
export function isPublicHoliday(date: Date): boolean {
  // ì¼ìš”ì¼ì€ í•­ìƒ ê³µíœ´ì¼ (ê´€ê³µì„œì˜ ê³µíœ´ì¼ì— ê´€í•œ ê·œì • ì œ2ì¡°)
  if (isSunday(date)) {
    return true;
  }

  const dateStr = date.toISOString().split('T')[0];
  return KOREAN_PUBLIC_HOLIDAYS_2025.includes(dateStr);
}
```

### 3. ìë™ íŠ¸ë¦¬ê±° ê¸°ë°˜ ê³„ì‚°
```sql
CREATE TRIGGER trigger_calculate_deadline
  BEFORE INSERT OR UPDATE OF trigger_date, deadline_type
  ON case_deadlines
  FOR EACH ROW
  EXECUTE FUNCTION calculate_deadline_dates();
```

---

## ğŸ“ ë¬¸ì˜

- **ê¸°ìˆ  ë¬¸ì˜**: admin@theyool.com
- **ë²•ë¥  ê²€í† **: ë²•ë¬´ë²•ì¸ ë”ìœ¨ ë³€í˜¸ì‚¬íŒ€
- **ì‹œìŠ¤í…œ ë¬¸ì˜**: Claude Code

---

## ğŸ“š ì¶”ê°€ ìë£Œ

- [LEGAL_DEADLINE_SYSTEM.md](./LEGAL_DEADLINE_SYSTEM.md) - ì „ì²´ ì‹œìŠ¤í…œ ë¬¸ì„œ
- [ë¯¼ë²• ì œ161ì¡°](https://www.law.go.kr/LSW/lsInfoP.do?lsiSeq=61603#0000)
- [ë¯¼ì‚¬ì†Œì†¡ë²• ê°œì • (2025. 3. 1. ì‹œí–‰)](https://www.classhklaw.com/newsletter_view.php?seq=2815)
- [ë‚˜í™€ë¡œ ë¯¼ì‚¬ì†Œì†¡ ê°€ì´ë“œ](https://easylaw.go.kr/CSP/CnpClsMain.laf?popMenu=ov&csmSeq=568&ccfNo=7&cciNo=2&cnpClsNo=1)

---

**ë²„ì „**: 2.0
**ì™„ë£Œì¼**: 2025-11-22
**ìƒíƒœ**: âœ… ëª¨ë“  ì‘ì—… ì™„ë£Œ ë° í…ŒìŠ¤íŠ¸ í†µê³¼
