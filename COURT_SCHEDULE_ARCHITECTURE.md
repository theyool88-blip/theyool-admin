# 법무법인 더율 - 이혼사건 기일 관리 시스템 아키텍처

## 📋 Executive Summary

이혼사건 기일 관리 시스템은 법무법인 더율의 사건 관리 효율성을 극대화하기 위한 핵심 기능입니다. 6가지 기일 유형과 5가지 불변기간을 체계적으로 관리하여 놓치는 기일 없이 완벽한 사건 진행을 지원합니다.

---

## 🗄️ 1. 데이터베이스 스키마 설계

### 핵심 설계 원칙
- **분리된 관심사**: 기일(court_hearings)과 불변기간(court_deadlines)을 별도 테이블로 분리
- **확장 가능성**: ENUM 타입과 마스터 데이터 테이블로 유연한 확장
- **추적 가능성**: 모든 변경사항과 연기 이력 추적
- **알림 통합**: 기일/불변기간 알림 로그 중앙화

### 테이블 구조

```sql
court_hearings (기일 관리)
├── 기본 정보: 유형, 날짜, 시간, 법원
├── 출석 요구: 변호사/당사자/상대방
├── 상태 추적: 예정/완료/연기/취소
└── 연기 이력: 이전/다음 기일 참조

court_deadlines (불변기간 관리)
├── 기간 정보: 기산일, 만료일, 일수
├── 알림 설정: 사전 알림 일수
├── 완료 추적: 완료 여부, 날짜
└── 관련 기일: 선택적 연결

hearing_subtypes (마스터 데이터)
├── 세부 유형: 변론준비기일, 증인신문기일 등
├── 기본값: 출석 요구사항 디폴트
└── 정렬 순서: UI 표시 순서

hearing_documents (기일 문서)
└── 준비서면, 증거자료, 신청서 관리

hearing_notifications (알림 로그)
└── SMS, 이메일, 카카오톡 발송 이력
```

---

## 🔗 2. 사건(legal_cases)과 기일의 관계

### 관계 모델링
```
legal_cases (1) ─────┬──── (N) court_hearings
                     │
                     └──── (N) court_deadlines
```

### 특징
- **일대다 관계**: 하나의 사건에 여러 기일과 불변기간
- **CASCADE 삭제**: 사건 삭제 시 관련 기일도 자동 삭제
- **독립적 관리**: 기일과 불변기간은 서로 독립적으로 관리
- **선택적 연결**: 불변기간은 특정 기일과 연결 가능 (예: 판결 → 항소기간)

---

## 💼 3. 불변기간 관리 전략

### 별도 테이블 분리 이유
1. **독립적 관리**: 기일과 무관한 불변기간 존재 (서면 제출 등)
2. **복잡도 감소**: 단일 책임 원칙 준수
3. **알림 최적화**: 기일과 불변기간의 알림 주기 차이
4. **확장성**: 향후 다양한 기간 관리 추가 용이

### 자동화 기능
```sql
-- 불변기간 자동 계산 함수
calculate_deadline_date(base_date, deadline_type)
→ 상소기간: +14일
→ 즉시항고: +7일
→ 항소이유서: +40일
```

---

## 🎨 4. UI/UX 설계

### 대시보드 구성

#### 1) 메인 대시보드
```
┌─────────────────────────────────────┐
│      오늘의 기일 (3)                │
├─────────────────────────────────────┤
│ • 10:00 서울가정법원 - 변론기일     │
│ • 14:00 의정부지원 - 조정기일       │
│ • 15:30 수원가정법원 - 증인신문     │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│      임박한 불변기간 (2)            │
├─────────────────────────────────────┤
│ ⚠️ D-2 항소기간 (김○○ 사건)        │
│ ⚠️ D-3 조정이의 (박○○ 사건)        │
└─────────────────────────────────────┘
```

#### 2) 캘린더 뷰
- **월간 캘린더**: 기일 종류별 색상 구분
- **주간 타임라인**: 시간대별 기일 표시
- **필터링**: 변호사별, 사건별, 기일 유형별

#### 3) 기일 등록 폼
```typescript
interface HearingFormData {
  // 스마트 선택
  caseId: string;           // 사건 선택 → 법원 자동 입력
  hearingType: string;       // 대분류 선택 → 세부 유형 필터링
  hearingSubtype: string;    // 세부 유형 선택 → 출석 요구 자동 설정

  // 커스터마이징
  overrideDefaults?: {
    lawyerRequired?: boolean;
    clientRequired?: boolean;
  };

  // 불변기간 자동 생성
  autoCreateDeadlines?: boolean; // 선고기일 시 항소기간 자동 생성
}
```

### 사용성 향상 기능

#### 1) 일괄 등록
- **반복 기일**: 매주 같은 요일/시간 반복 등록
- **템플릿**: 자주 사용하는 기일 패턴 저장

#### 2) 스마트 알림
```typescript
// 기일별 맞춤 알림
const notificationRules = {
  HEARING_MAIN: ['3일전', '1일전', '당일 오전'],
  HEARING_JUDGMENT: ['즉시', '항소기간 3일전'],
  DL_APPEAL: ['7일전', '3일전', '1일전', '당일']
};
```

#### 3) 충돌 방지
- **중복 체크**: 같은 시간대 다른 기일 경고
- **이동 시간 고려**: 법원 간 이동 시간 계산
- **변호사 일정 연동**: 담당 변호사 캘린더 확인

---

## 🔄 5. 기존 시스템과의 통합 전략

### case_schedules 테이블과의 관계

#### Option A: 완전 대체 (권장)
```sql
-- 마이그레이션 스크립트
INSERT INTO court_hearings (case_id, hearing_type, hearing_date, ...)
SELECT case_id,
       CASE schedule_type
         WHEN '변론' THEN 'HEARING_MAIN'::hearing_type
         ELSE 'HEARING_MAIN'::hearing_type
       END,
       schedule_date,
       ...
FROM case_schedules;

-- 이후 case_schedules 테이블 deprecate
```

#### Option B: 단계적 전환
1. **Phase 1**: 신규 기일은 court_hearings에 등록
2. **Phase 2**: 기존 데이터 점진적 마이그레이션
3. **Phase 3**: case_schedules 테이블 제거

### 통합 시 고려사항
- **데이터 무결성**: 외래키 제약 조건 유지
- **기능 연속성**: 기존 기능 중단 없이 전환
- **롤백 가능성**: 문제 발생 시 복구 계획

---

## 🚀 6. 구현 로드맵

### Phase 1: 기초 구축 (1주)
- [ ] 데이터베이스 마이그레이션 실행
- [ ] TypeScript 타입 정의
- [ ] Supabase 클라이언트 함수 구현
- [ ] 기본 CRUD API 엔드포인트

### Phase 2: 관리자 UI (2주)
- [ ] 기일 목록 페이지
- [ ] 기일 등록/수정 폼
- [ ] 캘린더 뷰 컴포넌트
- [ ] 불변기간 관리 페이지

### Phase 3: 자동화 (1주)
- [ ] 알림 시스템 연동
- [ ] 불변기간 자동 생성
- [ ] 기일 충돌 검사
- [ ] 대시보드 위젯

### Phase 4: 고급 기능 (2주)
- [ ] 문서 관리 통합
- [ ] 변호사 캘린더 연동
- [ ] 보고서 생성
- [ ] 모바일 앱 연동 준비

---

## 📁 프로젝트 구조

```
app/admin/court-schedule/
├── page.tsx                    # 기일 목록 메인
├── [id]/
│   └── page.tsx                # 기일 상세/수정
├── new/
│   └── page.tsx                # 신규 기일 등록
├── calendar/
│   └── page.tsx                # 캘린더 뷰
└── deadlines/
    └── page.tsx                # 불변기간 관리

components/features/court-schedule/
├── HearingCard.tsx             # 기일 카드 컴포넌트
├── HearingForm.tsx             # 기일 등록/수정 폼
├── DeadlineAlert.tsx           # 불변기간 알림
├── CalendarView.tsx            # 캘린더 컴포넌트
└── HearingTypeSelector.tsx    # 기일 유형 선택기

lib/supabase/
├── court-hearings.ts           # 기일 CRUD
├── court-deadlines.ts          # 불변기간 CRUD
└── hearing-notifications.ts   # 알림 관리

types/
├── court-hearing.ts            # 기일 타입
├── court-deadline.ts           # 불변기간 타입
└── hearing-enums.ts            # ENUM 타입 정의
```

---

## 🔐 보안 및 권한

### RLS 정책
```sql
-- 관리자: 모든 기일 조회/수정
-- 변호사: 담당 사건 기일만 조회/수정
-- 직원: 조회만 가능
```

### 감사 로그
- 모든 기일 변경사항 추적
- 연기/취소 사유 필수 입력
- 수정자 정보 자동 기록

---

## 📊 성과 지표 (KPI)

1. **기일 누락률**: 0% 목표
2. **알림 전달률**: 95% 이상
3. **평균 등록 시간**: 2분 이내
4. **불변기간 준수율**: 100%

---

## 🎯 핵심 가치

1. **완벽한 기일 관리**: 단 하나의 기일도 놓치지 않음
2. **효율적인 업무**: 자동화로 행정 부담 최소화
3. **선제적 대응**: 사전 알림으로 충분한 준비 시간 확보
4. **투명한 소통**: 의뢰인과 기일 정보 실시간 공유

---

## 📝 다음 단계 액션 아이템

1. **즉시 실행**
   - [ ] 데이터베이스 마이그레이션 검토 및 실행
   - [ ] TypeScript 타입 정의 파일 생성

2. **1주 내 완료**
   - [ ] 기본 CRUD API 구현
   - [ ] 관리자 기일 목록 페이지 구현

3. **2주 내 완료**
   - [ ] 캘린더 뷰 구현
   - [ ] 알림 시스템 연동

이 시스템은 법무법인 더율의 사건 관리 효율성을 획기적으로 개선하여, 변호사들이 핵심 업무에 집중할 수 있도록 지원할 것입니다.